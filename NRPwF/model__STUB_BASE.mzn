
/*
 * An automatic MiniZinc model
 */
 array[int] of int: nCovANUM = [3,3,0];
%  array[int] of int: nCovCNS = [1,1,0];
 array[int] of int: nCovAll = [6,6,3];
 
%%%%%% Change data: start %%%%%%
 int: nBioTypes = 9;
 int: nPatternLength = 4; % MAKE SURE TO CHANGE THE INDEX OF THE SCORING CONSTRAINT ACCORDINGLY
array[int] of BIOTYPES: nNurseBioType;
% array[int] of int: nShift_WS_DATA;
%%%%%% Change data: end %%%%%%
int: nEvalHorizon = 10;
%int: FatigueConstr;
int: nNurses;
int: nDays;
array[int] of int: nFatigueParams__DATA_1D = [431013|i in ALLPATTERNS];
array[int] of int: nWeekdayOf_input = [1, 2, 3, 4, 5, 6, 7,1,2,3, 4, 5, 6, 7,1,2,3, 4, 5, 6, 7,1, 2, 3, 4, 5, 6, 7,1,2,3,    4, 5, 6, 7,1,  2,3, 4, 5, 6, 7];
array[int] of int: nWeekdayOf = [ nWeekdayOf_input[i] | i in 1..nDays ];
array[int] of int: nNurseType = [1 | n in 1..nNurses];%[1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1,1,2,2,1,1];

% array[int] of int: nShift__DATA_1D = [
% 2, 1, 0, 1, 0, 0, 2, 2, 1, 0, 2, 1, 0, 1, 2, 1, 0, 2, 1, 0, 1,
% 2, 1, 0, 0, 2, 1, 0, 0, 2, 0, 2, 1, 0, 0, 0, 2, 0, 2, 1, 0, 0,
% 2, 1, 0, 1, 0, 0, 2, 2, 1, 0, 2, 1, 0, 1, 2, 1, 0, 2, 1, 0, 1,
% 2, 1, 0, 0, 2, 1, 0, 0, 2, 0, 2, 1, 0, 0, 0, 2, 0, 2, 1, 0, 0,
% 2, 1, 0, 1, 0, 0, 2, 2, 1, 0, 2, 1, 0, 1, 2, 1, 0, 2, 1, 0, 1,
% 2, 1, 0, 0, 2, 1, 0, 0, 2, 0, 2, 1, 0, 0, 0, 2, 0, 2, 1, 0, 0,
% 2, 1, 0, 1, 0, 0, 2, 2, 1, 0, 2, 1, 0, 1, 2, 1, 0, 2, 1, 0, 1,
% 2, 1, 0, 0, 2, 1, 0, 0, 2, 0, 2, 1, 0, 0, 0, 2, 0, 2, 1, 0, 0,
% 2, 1, 0, 1, 0, 0, 2, 2, 1, 0, 2, 1, 0, 1, 2, 1, 0, 2, 1, 0, 1,
% 2, 1, 0, 0, 2, 1, 0, 0, 2, 0, 2, 1, 0, 0, 0, 2, 0, 2, 1, 0, 0];
array[int] of int: nShiftScore__DATA_1D = [
390,390,389,396,390,390,389,396,392,392,391,413,466,466,468,442,390,390,389,396,390,390,389,396,392,392,391,440,466,466,468,485,427,427,421,455,427,427,421,455,425,425,419,446,614,614,610,533,488,488,487,508,488,488,487,508,493,493,492,541,590,590,597,590,390,390,389,396,390,390,389,396,392,392,391,413,466,466,468,442,390,390,389,396,390,390,389,396,392,392,391,440,466,466,468,485,427,427,421,455,427,427,421,455,425,425,419,446,614,614,610,533,488,488,487,508,488,488,487,508,493,493,492,541,590,590,597,590,427,427,422,435,427,427,422,435,421,421,416,413,466,466,468,442,427,427,422,435,427,427,422,435,421,421,416,440,466,466,468,485,427,427,421,455,427,427,421,455,425,425,419,446,614,614,610,533,614,614,609,632,614,614,609,632,610,610,605,541,590,590,597,590,450,450,446,458,450,450,446,458,444,444,440,421,479,479,475,456,450,450,446,458,450,450,446,458,444,444,440,458,479,479,475,492,448,448,443,456,448,448,443,456,441,441,436,446,614,614,610,533,559,559,558,563,559,559,558,563,559,559,558,541,590,590,597,590,355,355,355,358,355,355,355,358,355,355,355,362,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,366,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,362,469,469,469,553,408,408,408,412,408,408,408,412,408,408,408,420,535,535,535,564,355,355,355,358,355,355,355,358,355,355,355,362,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,366,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,362,469,469,469,553,408,408,408,412,408,408,408,412,408,408,408,420,535,535,535,564,355,355,355,358,355,355,355,358,355,355,355,362,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,366,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,362,469,469,469,553,468,468,468,482,468,468,468,482,468,468,468,473,553,553,553,564,355,355,355,363,355,355,355,363,355,355,355,362,408,408,408,438,355,355,355,363,355,355,355,363,355,355,355,366,408,408,408,438,355,355,355,363,355,355,355,363,355,355,355,362,469,469,469,553,491,491,491,503,491,491,491,503,491,491,491,496,535,535,535,564,435,435,433,439,435,435,436,442,442,442,439,449,473,473,462,453,435,435,439,448,435,435,437,444,457,457,461,485,514,514,515,495,516,516,495,508,516,516,513,553,509,509,486,498,585,585,537,540,569,569,581,592,569,569,580,571,599,599,595,618,634,634,666,656,435,435,435,439,435,435,436,442,442,442,442,449,473,473,462,455,435,435,439,448,435,435,437,444,457,457,461,485,514,514,515,495,516,516,495,508,516,516,513,553,509,509,486,498,585,585,537,540,569,569,581,592,569,569,580,571,599,599,595,618,634,634,666,656,516,516,494,498,516,516,509,526,491,491,467,453,506,506,462,458,516,516,502,512,516,516,511,530,512,512,502,510,553,553,536,551,516,516,495,508,516,516,513,553,509,509,486,498,585,585,537,540,580,580,581,592,580,580,580,597,599,599,595,618,634,634,666,656,529,529,518,521,529,529,528,530,514,514,490,476,529,529,484,481,529,529,526,530,529,529,529,531,531,531,525,533,542,542,542,541,527,527,502,508,527,527,518,553,509,509,486,498,585,585,537,540,569,569,581,592,569,569,580,571,599,599,595,618,634,634,666,656,394,394,393,395,394,394,393,395,394,394,393,417,437,437,453,434,394,394,393,395,394,394,393,395,394,394,393,423,437,437,453,434,461,461,456,483,461,461,456,483,471,471,462,507,642,642,651,690,481,481,488,482,481,481,488,482,501,501,506,539,544,544,561,539,394,394,393,395,394,394,393,395,394,394,393,417,437,437,453,434,394,394,393,395,394,394,393,395,394,394,393,423,437,437,453,434,461,461,456,483,461,461,456,483,471,471,462,507,642,642,651,690,481,481,488,482,481,481,488,482,501,501,506,539,544,544,561,539,473,473,465,477,473,473,465,477,463,463,456,457,497,497,492,511,473,473,465,477,473,473,465,477,463,463,456,472,497,497,492,511,476,476,467,483,476,476,467,483,471,471,462,507,642,642,651,690,654,654,654,659,654,654,654,659,658,658,653,668,707,707,711,714,469,469,475,467,469,469,475,467,478,478,476,477,474,474,481,464,469,469,475,467,469,469,475,467,478,478,476,481,474,474,481,464,488,488,488,490,488,488,488,490,487,487,479,507,642,642,651,690,542,542,551,540,542,542,551,540,556,556,560,569,544,544,561,539,357,357,357,357,357,357,357,357,357,357,356,360,383,383,389,397,357,357,357,357,357,357,357,357,357,357,356,360,383,383,389,397,372,372,370,385,372,372,370,385,375,375,372,401,512,512,513,568,417,417,416,421,417,417,416,421,418,418,417,437,490,490,496,503,357,357,357,357,357,357,357,357,357,357,356,360,383,383,389,397,357,357,357,357,357,357,357,357,357,357,356,360,383,383,389,397,372,372,370,385,372,372,370,385,375,375,372,401,512,512,513,568,417,417,416,421,417,417,416,421,418,418,417,437,490,490,496,503,383,383,381,387,383,383,381,387,379,379,377,376,399,399,398,409,383,383,381,387,383,383,381,387,379,379,377,376,399,399,398,409,384,384,380,389,384,384,380,389,379,379,376,401,512,512,513,568,523,523,520,533,523,523,520,533,522,522,518,532,581,581,582,595,396,396,395,399,396,396,395,399,395,395,393,393,410,410,410,418,396,396,395,399,396,396,395,399,395,395,393,393,410,410,410,418,400,400,397,404,400,400,397,404,396,396,395,401,512,512,513,568,487,487,489,487,487,487,489,487,492,492,493,502,502,502,506,503,441,441,439,445,441,441,440,445,442,442,449,476,475,475,477,464,441,441,439,445,441,441,440,445,445,445,460,497,475,475,497,474,550,550,541,583,550,550,547,583,562,562,541,607,757,757,629,804,527,527,543,527,527,527,538,527,566,566,589,606,579,579,601,536,441,441,439,445,441,441,440,445,442,442,449,476,475,475,477,464,441,441,439,445,441,441,440,445,445,445,460,497,475,475,497,474,550,550,541,583,550,550,547,583,562,562,541,607,757,757,629,804,527,527,543,527,527,527,538,527,566,566,589,606,579,579,601,586,559,559,547,572,559,559,551,572,544,544,528,541,599,599,554,618,559,559,547,572,559,559,551,572,552,552,546,572,599,599,591,622,563,563,547,583,563,563,552,583,562,562,541,607,757,757,629,804,769,769,768,776,769,769,770,776,630,630,589,606,825,825,608,811,515,515,522,509,515,515,520,509,526,526,530,533,514,514,531,488,515,515,522,509,515,515,520,509,525,525,529,529,514,514,524,500,550,550,543,583,550,550,547,583,562,562,541,607,757,757,629,804,578,578,592,561,578,578,588,561,572,572,589,606,579,579,601,536,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,396,395,396,408,396,394,396,411,396,395,396,408,444,448,444,429,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,482,483,482,489,486,486,486,502,482,483,482,489,553,558,553,528,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,396,395,396,408,396,394,396,411,396,395,396,408,444,448,444,429,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,482,483,482,489,486,486,486,502,482,483,482,489,553,558,553,528,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,396,395,396,408,396,394,396,411,396,395,396,408,444,448,444,429,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,482,483,482,489,486,486,486,502,482,483,482,489,553,558,553,528,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,396,395,396,408,396,394,396,411,396,395,396,408,444,448,444,429,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,482,483,482,489,486,486,486,502,482,483,482,489,553,558,553,528,355,355,355,357,355,355,355,357,355,355,355,358,399,399,399,387,356,356,356,359,356,356,356,359,356,356,356,364,399,399,399,425,355,355,355,357,355,355,355,357,355,355,355,358,417,417,417,387,395,395,395,405,395,395,395,405,395,395,395,410,527,527,527,499,355,355,355,357,355,355,355,357,355,355,355,358,399,399,399,387,356,356,356,359,356,356,356,359,356,356,356,364,399,399,399,425,355,355,355,357,355,355,355,357,355,355,355,358,417,417,417,387,395,395,395,405,395,395,395,405,395,395,395,410,527,527,527,499,355,355,355,357,355,355,355,357,355,355,355,358,399,399,399,387,356,356,356,359,356,356,356,359,356,356,356,364,399,399,399,425,355,355,355,357,355,355,355,357,355,355,355,358,417,417,417,387,402,402,402,422,402,402,402,422,402,402,402,414,527,527,527,499,355,355,355,357,355,355,355,357,355,355,355,358,399,399,399,387,356,356,356,359,356,356,356,359,356,356,356,364,399,399,399,425,355,355,355,357,355,355,355,357,355,355,355,358,417,417,417,387,426,426,426,446,426,426,426,446,426,426,426,437,527,527,527,499,433,433,432,439,433,433,435,445,441,441,438,450,469,469,456,455,433,433,440,447,433,433,440,448,458,458,462,486,517,517,508,500,504,504,478,505,504,504,496,540,493,493,467,492,565,565,508,534,583,583,584,596,583,583,588,586,602,602,598,624,651,651,664,664,433,433,435,439,433,433,435,445,441,441,438,450,469,469,456,455,433,433,440,447,433,433,440,448,458,458,462,486,517,517,508,500,504,504,478,505,504,504,496,540,493,493,467,492,565,565,508,534,583,583,584,596,583,583,588,586,602,602,598,624,651,651,664,664,486,486,451,472,486,486,470,500,449,449,438,450,469,469,456,455,486,486,466,485,486,486,478,505,479,479,463,486,522,522,508,529,504,504,478,505,504,504,496,540,493,493,467,492,565,565,508,534,583,583,584,596,583,583,588,586,602,602,598,624,651,651,664,664,509,509,474,495,509,509,493,523,472,472,439,450,486,486,456,457,509,509,489,508,509,509,501,528,502,502,486,503,539,539,520,540,504,504,478,505,504,504,496,540,493,493,467,492,565,565,508,534,583,583,584,596,583,583,588,586,602,602,598,624,651,651,664,664];
%390,390,389,396,390,390,389,396,392,392,391,413,466,466,468,442,390,390,389,396,390,390,389,396,392,392,391,440,466,466,468,485,427,427,421,455,427,427,421,455,425,425,419,446,614,614,610,533,488,488,487,508,488,488,487,508,493,493,492,541,590,590,597,590,390,390,389,396,390,390,389,396,392,392,391,413,466,466,468,442,390,390,389,396,390,390,389,396,392,392,391,440,466,466,468,485,427,427,421,455,427,427,421,455,425,425,419,446,614,614,610,533,488,488,487,508,488,488,487,508,493,493,492,541,590,590,597,590,427,427,422,435,427,427,422,435,421,421,416,413,466,466,468,442,427,427,422,435,427,427,422,435,421,421,416,440,466,466,468,485,427,427,421,455,427,427,421,455,425,425,419,446,614,614,610,533,614,614,609,632,614,614,609,632,610,610,605,541,590,590,597,590,450,450,446,458,450,450,446,458,444,444,440,421,479,479,475,456,450,450,446,458,450,450,446,458,444,444,440,458,479,479,475,492,448,448,443,456,448,448,443,456,441,441,436,446,614,614,610,533,559,559,558,563,559,559,558,563,559,559,558,541,590,590,597,590,355,355,355,358,355,355,355,358,355,355,355,362,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,366,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,362,469,469,469,553,408,408,408,412,408,408,408,412,408,408,408,420,535,535,535,564,355,355,355,358,355,355,355,358,355,355,355,362,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,366,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,362,469,469,469,553,408,408,408,412,408,408,408,412,408,408,408,420,535,535,535,564,355,355,355,358,355,355,355,358,355,355,355,362,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,366,408,408,408,438,355,355,355,358,355,355,355,358,355,355,355,362,469,469,469,553,468,468,468,482,468,468,468,482,468,468,468,473,553,553,553,564,355,355,355,363,355,355,355,363,355,355,355,362,408,408,408,438,355,355,355,363,355,355,355,363,355,355,355,366,408,408,408,438,355,355,355,363,355,355,355,363,355,355,355,362,469,469,469,553,491,491,491,503,491,491,491,503,491,491,491,496,535,535,535,564,435,435,433,439,435,435,436,442,442,442,439,449,473,473,462,453,435,435,439,448,435,435,437,444,457,457,461,485,514,514,515,495,516,516,495,508,516,516,513,553,509,509,486,498,585,585,537,540,569,569,581,592,569,569,580,571,599,599,595,618,634,634,666,656,435,435,435,439,435,435,436,442,442,442,442,449,473,473,462,455,435,435,439,448,435,435,437,444,457,457,461,485,514,514,515,495,516,516,495,508,516,516,513,553,509,509,486,498,585,585,537,540,569,569,581,592,569,569,580,571,599,599,595,618,634,634,666,656,516,516,494,498,516,516,509,526,491,491,467,453,506,506,462,458,516,516,502,512,516,516,511,530,512,512,502,510,553,553,536,551,516,516,495,508,516,516,513,553,509,509,486,498,585,585,537,540,580,580,581,592,580,580,580,597,599,599,595,618,634,634,666,656,529,529,518,521,529,529,528,530,514,514,490,476,529,529,484,481,529,529,526,530,529,529,529,531,531,531,525,533,542,542,542,541,527,527,502,508,527,527,518,553,509,509,486,498,585,585,537,540,569,569,581,592,569,569,580,571,599,599,595,618,634,634,666,656,394,394,393,395,394,394,393,395,394,394,393,417,437,437,453,434,394,394,393,395,394,394,393,395,394,394,393,423,437,437,453,434,461,461,456,483,461,461,456,483,471,471,462,507,642,642,651,690,481,481,488,482,481,481,488,482,501,501,506,539,544,544,561,539,394,394,393,395,394,394,393,395,394,394,393,417,437,437,453,434,394,394,393,395,394,394,393,395,394,394,393,423,437,437,453,434,461,461,456,483,461,461,456,483,471,471,462,507,642,642,651,690,481,481,488,482,481,481,488,482,501,501,506,539,544,544,561,539,473,473,465,477,473,473,465,477,463,463,456,457,497,497,492,511,473,473,465,477,473,473,465,477,463,463,456,472,497,497,492,511,476,476,467,483,476,476,467,483,471,471,462,507,642,642,651,690,654,654,654,659,654,654,654,659,658,658,653,668,707,707,711,714,469,469,475,467,469,469,475,467,478,478,476,477,474,474,481,464,469,469,475,467,469,469,475,467,478,478,476,481,474,474,481,464,488,488,488,490,488,488,488,490,487,487,479,507,642,642,651,690,542,542,551,540,542,542,551,540,556,556,560,569,544,544,561,539,357,357,357,357,357,357,357,357,357,357,356,360,383,383,389,397,357,357,357,357,357,357,357,357,357,357,356,360,383,383,389,397,372,372,370,385,372,372,370,385,375,375,372,401,512,512,513,568,417,417,416,421,417,417,416,421,418,418,417,437,490,490,496,503,357,357,357,357,357,357,357,357,357,357,356,360,383,383,389,397,357,357,357,357,357,357,357,357,357,357,356,360,383,383,389,397,372,372,370,385,372,372,370,385,375,375,372,401,512,512,513,568,417,417,416,421,417,417,416,421,418,418,417,437,490,490,496,503,383,383,381,387,383,383,381,387,379,379,377,376,399,399,398,409,383,383,381,387,383,383,381,387,379,379,377,376,399,399,398,409,384,384,380,389,384,384,380,389,379,379,376,401,512,512,513,568,523,523,520,533,523,523,520,533,522,522,518,532,581,581,582,595,396,396,395,399,396,396,395,399,395,395,393,393,410,410,410,418,396,396,395,399,396,396,395,399,395,395,393,393,410,410,410,418,400,400,397,404,400,400,397,404,396,396,395,401,512,512,513,568,487,487,489,487,487,487,489,487,492,492,493,502,502,502,506,503,441,441,439,445,441,441,440,445,442,442,449,476,475,475,477,464,441,441,439,445,441,441,440,445,445,445,460,497,475,475,497,474,550,550,541,583,550,550,547,583,562,562,541,607,757,757,629,804,527,527,543,527,527,527,538,527,566,566,589,606,579,579,601,536,441,441,439,445,441,441,440,445,442,442,449,476,475,475,477,464,441,441,439,445,441,441,440,445,445,445,460,497,475,475,497,474,550,550,541,583,550,550,547,583,562,562,541,607,757,757,629,804,527,527,543,527,527,527,538,527,566,566,589,606,579,579,601,586,559,559,547,572,559,559,551,572,544,544,528,541,599,599,554,618,559,559,547,572,559,559,551,572,552,552,546,572,599,599,591,622,563,563,547,583,563,563,552,583,562,562,541,607,757,757,629,804,769,769,768,776,769,769,770,776,630,630,589,606,825,825,608,811,515,515,522,509,515,515,520,509,526,526,530,533,514,514,531,488,515,515,522,509,515,515,520,509,525,525,529,529,514,514,524,500,550,550,543,583,550,550,547,583,562,562,541,607,757,757,629,804,578,578,592,561,578,578,588,561,572,572,589,606,579,579,601,536,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,396,395,396,408,396,394,396,411,396,395,396,408,444,448,444,429,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,482,483,482,489,486,486,486,502,482,483,482,489,553,558,553,528,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,396,395,396,408,396,394,396,411,396,395,396,408,444,448,444,429,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,482,483,482,489,486,486,486,502,482,483,482,489,553,558,553,528,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,396,395,396,408,396,394,396,411,396,395,396,408,444,448,444,429,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,482,483,482,489,486,486,486,502,482,483,482,489,553,558,553,528,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,396,395,396,408,396,394,396,411,396,395,396,408,444,448,444,429,383,384,383,385,386,386,386,393,383,384,383,385,409,411,409,405,482,483,482,489,486,486,486,502,482,483,482,489,553,558,553,528,355,355,355,357,355,355,355,357,355,355,355,358,399,399,399,387,356,356,356,359,356,356,356,359,356,356,356,364,399,399,399,425,355,355,355,357,355,355,355,357,355,355,355,358,417,417,417,387,395,395,395,405,395,395,395,405,395,395,395,410,527,527,527,499,355,355,355,357,355,355,355,357,355,355,355,358,399,399,399,387,356,356,356,359,356,356,356,359,356,356,356,364,399,399,399,425,355,355,355,357,355,355,355,357,355,355,355,358,417,417,417,387,395,395,395,405,395,395,395,405,395,395,395,410,527,527,527,499,355,355,355,357,355,355,355,357,355,355,355,358,399,399,399,387,356,356,356,359,356,356,356,359,356,356,356,364,399,399,399,425,355,355,355,357,355,355,355,357,355,355,355,358,417,417,417,387,402,402,402,422,402,402,402,422,402,402,402,414,527,527,527,499,355,355,355,357,355,355,355,357,355,355,355,358,399,399,399,387,356,356,356,359,356,356,356,359,356,356,356,364,399,399,399,425,355,355,355,357,355,355,355,357,355,355,355,358,417,417,417,387,426,426,426,446,426,426,426,446,426,426,426,437,527,527,527,499,433,433,432,439,433,433,435,445,441,441,438,450,469,469,456,455,433,433,440,447,433,433,440,448,458,458,462,486,517,517,508,500,504,504,478,505,504,504,496,540,493,493,467,492,565,565,508,534,583,583,584,596,583,583,588,586,602,602,598,624,651,651,664,664,433,433,435,439,433,433,435,445,441,441,438,450,469,469,456,455,433,433,440,447,433,433,440,448,458,458,462,486,517,517,508,500,504,504,478,505,504,504,496,540,493,493,467,492,565,565,508,534,583,583,584,596,583,583,588,586,602,602,598,624,651,651,664,664,486,486,451,472,486,486,470,500,449,449,438,450,469,469,456,455,486,486,466,485,486,486,478,505,479,479,463,486,522,522,508,529,504,504,478,505,504,504,496,540,493,493,467,492,565,565,508,534,583,583,584,596,583,583,588,586,602,602,598,624,651,651,664,664,509,509,474,495,509,509,493,523,472,472,439,450,486,486,456,457,509,509,489,508,509,509,501,528,502,502,486,503,539,539,520,540,504,504,478,505,504,504,496,540,493,493,467,492,565,565,508,534,583,583,584,596,583,583,588,586,602,602,598,624,651,651,664,664];

array[int] of int: nShiftScoreAfterNight__DATA_1D =
[391,391,389,395,391,391,392,395,395,395,392,405,468,468,431,437,391,391,389,395,391,391,392,395,395,395,399,426,468,468,474,484,436,436,412,440,436,436,432,468,435,435,406,429,631,631,483,509,490,490,488,501,490,490,494,515,500,500,496,523,587,587,592,605,391,391,389,395,391,391,392,395,395,395,392,405,468,468,431,437,391,391,389,395,391,391,392,395,395,395,399,426,468,468,474,484,436,436,412,440,436,436,432,468,435,435,406,429,631,631,483,509,490,490,488,501,490,490,494,515,500,500,496,523,587,587,592,605,433,433,413,428,433,433,426,442,424,424,400,405,468,468,431,437,433,433,413,428,433,433,426,442,424,424,411,426,468,468,474,484,436,436,412,440,436,436,432,468,435,435,406,429,631,631,483,509,621,621,600,621,621,621,616,642,616,616,590,523,587,587,592,605,457,457,436,451,457,457,450,465,447,447,423,421,484,484,431,438,457,457,436,451,457,457,450,465,447,447,434,449,484,484,474,484,455,455,434,448,455,455,447,468,444,444,420,429,631,631,483,509,560,560,556,561,560,560,560,565,561,561,555,523,587,587,592,605,356,356,355,361,356,356,355,361,356,356,355,370,410,410,412,407,356,356,355,361,356,356,355,361,356,356,355,386,410,410,412,443,356,356,355,366,356,356,355,366,356,356,355,370,482,482,474,455,409,409,407,418,409,409,408,418,409,409,407,441,539,539,546,537,356,356,355,361,356,356,355,361,356,356,355,370,410,410,412,407,356,356,355,361,356,356,355,361,356,356,355,386,410,410,412,443,356,356,355,366,356,356,355,366,356,356,355,370,482,482,474,455,409,409,407,418,409,409,408,418,409,409,407,441,539,539,546,537,356,356,355,361,356,356,355,361,356,356,355,370,410,410,412,407,356,356,355,361,356,356,355,361,356,356,355,386,410,410,412,443,356,356,355,366,356,356,355,366,356,356,355,370,482,482,474,455,475,475,464,492,475,475,468,492,475,475,464,473,561,561,546,537,361,361,355,368,361,361,355,368,361,361,355,370,410,410,412,407,361,361,355,368,361,361,355,368,361,361,355,386,410,410,412,443,361,361,355,368,361,361,355,368,361,361,355,370,482,482,474,455,498,498,488,505,498,498,491,505,498,498,488,497,539,539,546,537,436,436,435,439,436,436,441,440,447,447,443,453,478,478,456,462,436,436,447,440,436,436,444,440,463,463,473,485,508,508,503,499,529,529,492,529,529,529,532,576,523,523,482,519,609,609,526,564,560,560,586,576,560,560,579,542,605,605,604,624,619,619,661,632,436,436,438,439,436,436,441,440,447,447,445,453,478,478,456,462,436,436,447,440,436,436,444,440,463,463,473,485,508,508,503,499,529,529,492,529,529,529,532,576,523,523,482,519,609,609,526,564,560,560,586,576,560,560,579,542,605,605,604,624,619,619,661,632,524,524,485,517,524,524,517,546,497,497,450,474,524,524,456,501,524,524,502,520,524,524,521,546,519,519,501,520,564,564,536,567,529,529,492,529,529,529,532,576,523,523,482,519,609,609,526,564,599,599,586,577,599,599,579,767,605,605,604,624,619,619,661,632,529,529,508,530,529,529,530,527,520,520,473,497,536,536,461,524,529,529,526,530,529,529,530,527,533,533,524,535,539,539,542,538,537,537,493,529,537,537,532,576,523,523,482,519,609,609,526,564,567,567,586,576,567,567,579,593,605,605,604,624,619,619,661,632,395,395,394,397,395,395,394,397,394,394,396,416,427,427,457,411,395,395,394,397,395,395,394,397,394,394,397,421,427,427,457,411,465,465,458,490,465,465,461,490,479,479,465,525,641,641,659,685,480,480,491,481,480,480,487,481,498,498,512,533,534,534,565,516,395,395,394,397,395,395,394,397,394,394,396,416,427,427,457,411,395,395,394,397,395,395,394,397,394,394,397,421,427,427,457,411,465,465,458,490,465,465,461,490,479,479,465,525,641,641,659,685,480,480,491,481,480,480,487,481,498,498,512,533,534,534,565,516,477,477,465,484,477,477,467,484,467,467,453,464,500,500,493,517,477,477,465,484,477,477,467,484,467,467,453,479,500,500,493,517,482,482,466,494,482,482,469,494,479,479,465,525,641,641,659,685,654,654,654,658,654,654,655,658,660,660,652,673,704,704,714,704,465,465,476,460,465,465,474,460,476,476,474,482,469,469,481,451,465,465,476,460,465,465,474,460,476,476,474,478,469,469,481,451,487,487,487,490,487,487,490,490,491,491,475,525,641,641,659,685,536,536,552,528,536,536,550,528,553,553,563,565,534,534,565,516,357,357,357,357,357,357,357,357,357,357,356,365,379,379,396,390,357,357,357,357,357,357,357,357,357,357,356,365,379,379,396,390,374,374,370,392,374,374,370,392,380,380,372,414,519,519,524,575,418,418,416,423,418,418,416,423,419,419,417,451,486,486,504,497,357,357,357,357,357,357,357,357,357,357,356,365,379,379,396,390,357,357,357,357,357,357,357,357,357,357,356,365,379,379,396,390,374,374,370,392,374,374,370,392,380,380,372,414,519,519,524,575,418,418,416,423,418,418,416,423,419,419,417,451,486,486,504,497,387,387,379,391,387,387,379,391,382,382,374,376,403,403,397,413,387,387,379,391,387,387,379,391,382,382,374,378,403,403,397,413,388,388,379,393,388,388,379,393,382,382,373,414,519,519,524,575,527,527,519,539,527,527,519,539,526,526,517,539,582,582,586,595,398,398,394,401,398,398,394,401,396,396,391,393,412,412,410,420,398,398,394,401,398,398,394,401,396,396,391,394,412,412,410,420,403,403,396,407,403,403,396,407,399,399,392,414,519,519,524,575,484,484,490,485,484,484,490,485,491,491,495,505,497,497,510,497,442,442,439,447,442,442,441,447,442,442,455,475,459,459,476,465,442,442,439,447,442,442,441,447,445,445,471,490,459,459,495,470,557,557,546,593,557,557,562,594,578,578,546,633,757,757,627,787,527,527,544,525,527,527,534,525,562,562,600,596,563,563,601,526,442,442,439,447,442,442,441,447,442,442,455,475,459,459,476,465,442,442,439,447,442,442,441,447,445,445,471,490,459,459,495,470,557,557,546,593,557,557,562,594,578,578,546,633,757,757,627,787,527,527,544,525,527,527,534,525,562,562,600,596,568,568,601,592,566,566,548,584,566,566,558,583,551,551,524,554,605,605,554,623,566,566,548,584,566,566,558,583,559,559,549,584,605,605,594,630,573,573,548,606,573,573,562,604,578,578,546,633,757,757,627,787,770,770,769,772,770,770,773,773,779,779,600,625,819,819,606,791,510,510,522,496,510,510,518,498,525,525,531,530,505,505,531,465,510,510,522,496,510,510,518,498,523,523,530,524,505,505,522,485,557,557,546,593,557,557,562,594,578,578,546,633,757,757,627,787,569,569,592,537,569,569,582,539,591,591,600,596,563,563,601,526,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,400,402,396,402,397,406,395,406,415,402,396,402,398,426,449,426,388,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,413,479,483,479,456,490,490,490,502,479,483,479,458,513,559,513,458,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,470,402,396,402,397,406,395,406,415,402,396,402,398,426,449,426,388,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,448,479,483,479,456,490,490,490,502,479,483,479,458,513,559,513,506,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,400,402,396,402,397,406,395,406,415,402,396,402,398,426,449,426,388,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,413,479,483,479,456,490,490,490,502,479,483,479,458,513,559,513,458,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,400,402,396,402,397,406,395,406,415,402,396,402,398,426,449,426,388,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,413,479,483,479,456,490,490,490,502,479,483,479,458,513,559,513,458,355,355,355,356,355,355,355,359,355,355,355,356,401,401,401,375,355,355,356,366,355,355,355,364,355,355,356,366,401,401,401,406,355,355,355,356,355,355,355,359,355,355,355,356,425,425,419,375,395,395,394,400,395,395,396,413,395,395,394,400,533,533,533,466,355,355,355,356,355,355,355,359,355,355,355,356,401,401,401,375,355,355,356,366,355,355,355,364,355,355,356,366,401,401,401,406,355,355,355,356,355,355,355,359,355,355,355,356,425,425,419,375,395,395,394,400,395,395,396,413,395,395,394,400,533,533,533,466,355,355,355,356,355,355,355,359,355,355,355,356,401,401,401,375,355,355,356,366,355,355,355,364,355,355,356,366,401,401,401,406,355,355,355,356,355,355,355,359,355,355,355,356,425,425,419,375,407,407,398,400,413,413,412,427,407,407,398,400,533,533,533,466,355,355,355,356,355,355,355,359,355,355,355,356,401,401,401,375,355,355,356,366,355,355,355,364,355,355,356,366,401,401,401,406,355,355,355,356,355,355,355,359,355,355,355,356,425,425,419,375,430,430,422,400,437,437,435,450,430,430,422,400,533,533,533,466,434,434,434,437,434,434,441,437,445,445,442,472,475,475,455,459,434,434,445,437,434,434,446,437,464,464,472,518,513,513,501,490,518,518,481,567,518,518,514,567,509,509,469,556,593,593,514,605,576,576,588,558,576,576,597,558,611,611,607,661,633,633,663,585,434,434,436,437,434,434,441,437,445,445,442,472,475,475,455,459,434,434,445,437,434,434,446,437,464,464,472,518,513,513,501,490,518,518,481,567,518,518,514,567,509,509,469,556,593,593,514,605,576,576,588,558,576,576,597,558,611,611,607,661,633,633,663,585,498,498,450,523,498,498,481,523,459,459,442,472,489,489,455,530,498,498,469,523,498,498,490,523,488,488,472,518,536,536,504,582,518,518,481,567,518,518,514,567,509,509,469,556,593,593,514,605,576,576,588,601,576,576,597,601,611,611,607,661,633,633,663,585,521,521,473,531,521,521,504,531,482,482,442,472,512,512,455,535,521,521,492,531,521,521,513,531,511,511,489,535,541,541,527,537,518,518,481,567,518,518,514,567,509,509,469,556,593,593,514,605,576,576,588,567,576,576,597,567,611,611,607,661,633,633,663,585]; %[391,391,389,395,391,391,392,395,395,395,392,405,468,468,431,437,391,391,389,395,391,391,392,395,395,395,399,426,468,468,474,484,436,436,412,440,436,436,432,468,435,435,406,429,631,631,483,509,490,490,488,501,490,490,494,515,500,500,496,523,587,587,592,605,391,391,389,395,391,391,392,395,395,395,392,405,468,468,431,437,391,391,389,395,391,391,392,395,395,395,399,426,468,468,474,484,436,436,412,440,436,436,432,468,435,435,406,429,631,631,483,509,490,490,488,501,490,490,494,515,500,500,496,523,587,587,592,605,433,433,413,428,433,433,426,442,424,424,400,405,468,468,431,437,433,433,413,428,433,433,426,442,424,424,411,426,468,468,474,484,436,436,412,440,436,436,432,468,435,435,406,429,631,631,483,509,621,621,600,621,621,621,616,642,616,616,590,523,587,587,592,605,457,457,436,451,457,457,450,465,447,447,423,421,484,484,431,438,457,457,436,451,457,457,450,465,447,447,434,449,484,484,474,484,455,455,434,448,455,455,447,468,444,444,420,429,631,631,483,509,560,560,556,561,560,560,560,565,561,561,555,523,587,587,592,605,356,356,355,361,356,356,355,361,356,356,355,370,410,410,412,407,356,356,355,361,356,356,355,361,356,356,355,386,410,410,412,443,356,356,355,366,356,356,355,366,356,356,355,370,482,482,474,455,409,409,407,418,409,409,408,418,409,409,407,441,539,539,546,537,356,356,355,361,356,356,355,361,356,356,355,370,410,410,412,407,356,356,355,361,356,356,355,361,356,356,355,386,410,410,412,443,356,356,355,366,356,356,355,366,356,356,355,370,482,482,474,455,409,409,407,418,409,409,408,418,409,409,407,441,539,539,546,537,356,356,355,361,356,356,355,361,356,356,355,370,410,410,412,407,356,356,355,361,356,356,355,361,356,356,355,386,410,410,412,443,356,356,355,366,356,356,355,366,356,356,355,370,482,482,474,455,475,475,464,492,475,475,468,492,475,475,464,473,561,561,546,537,361,361,355,368,361,361,355,368,361,361,355,370,410,410,412,407,361,361,355,368,361,361,355,368,361,361,355,386,410,410,412,443,361,361,355,368,361,361,355,368,361,361,355,370,482,482,474,455,498,498,488,505,498,498,491,505,498,498,488,497,539,539,546,537,436,436,435,439,436,436,441,440,447,447,443,453,478,478,456,462,436,436,447,440,436,436,444,440,463,463,473,485,508,508,503,499,529,529,492,529,529,529,532,576,523,523,482,519,609,609,526,564,560,560,586,576,560,560,579,542,605,605,604,624,619,619,661,632,436,436,438,439,436,436,441,440,447,447,445,453,478,478,456,462,436,436,447,440,436,436,444,440,463,463,473,485,508,508,503,499,529,529,492,529,529,529,532,576,523,523,482,519,609,609,526,564,560,560,586,576,560,560,579,542,605,605,604,624,619,619,661,632,524,524,485,517,524,524,517,546,497,497,450,474,524,524,456,501,524,524,502,520,524,524,521,546,519,519,501,520,564,564,536,567,529,529,492,529,529,529,532,576,523,523,482,519,609,609,526,564,599,599,586,577,599,599,579,767,605,605,604,624,619,619,661,632,529,529,508,530,529,529,530,527,520,520,473,497,536,536,461,524,529,529,526,530,529,529,530,527,533,533,524,535,539,539,542,538,537,537,493,529,537,537,532,576,523,523,482,519,609,609,526,564,567,567,586,576,567,567,579,593,605,605,604,624,619,619,661,632,395,395,394,397,395,395,394,397,394,394,396,416,427,427,457,411,395,395,394,397,395,395,394,397,394,394,397,421,427,427,457,411,465,465,458,490,465,465,461,490,479,479,465,525,641,641,659,685,480,480,491,481,480,480,487,481,498,498,512,533,534,534,565,516,395,395,394,397,395,395,394,397,394,394,396,416,427,427,457,411,395,395,394,397,395,395,394,397,394,394,397,421,427,427,457,411,465,465,458,490,465,465,461,490,479,479,465,525,641,641,659,685,480,480,491,481,480,480,487,481,498,498,512,533,534,534,565,516,477,477,465,484,477,477,467,484,467,467,453,464,500,500,493,517,477,477,465,484,477,477,467,484,467,467,453,479,500,500,493,517,482,482,466,494,482,482,469,494,479,479,465,525,641,641,659,685,654,654,654,658,654,654,655,658,660,660,652,673,704,704,714,704,465,465,476,460,465,465,474,460,476,476,474,482,469,469,481,451,465,465,476,460,465,465,474,460,476,476,474,478,469,469,481,451,487,487,487,490,487,487,490,490,491,491,475,525,641,641,659,685,536,536,552,528,536,536,550,528,553,553,563,565,534,534,565,516,357,357,357,357,357,357,357,357,357,357,356,365,379,379,396,390,357,357,357,357,357,357,357,357,357,357,356,365,379,379,396,390,374,374,370,392,374,374,370,392,380,380,372,414,519,519,524,575,418,418,416,423,418,418,416,423,419,419,417,451,486,486,504,497,357,357,357,357,357,357,357,357,357,357,356,365,379,379,396,390,357,357,357,357,357,357,357,357,357,357,356,365,379,379,396,390,374,374,370,392,374,374,370,392,380,380,372,414,519,519,524,575,418,418,416,423,418,418,416,423,419,419,417,451,486,486,504,497,387,387,379,391,387,387,379,391,382,382,374,376,403,403,397,413,387,387,379,391,387,387,379,391,382,382,374,378,403,403,397,413,388,388,379,393,388,388,379,393,382,382,373,414,519,519,524,575,527,527,519,539,527,527,519,539,526,526,517,539,582,582,586,595,398,398,394,401,398,398,394,401,396,396,391,393,412,412,410,420,398,398,394,401,398,398,394,401,396,396,391,394,412,412,410,420,403,403,396,407,403,403,396,407,399,399,392,414,519,519,524,575,484,484,490,485,484,484,490,485,491,491,495,505,497,497,510,497,442,442,439,447,442,442,441,447,442,442,455,475,459,459,476,465,442,442,439,447,442,442,441,447,445,445,471,490,459,459,495,470,557,557,546,593,557,557,562,594,578,578,546,633,757,757,627,787,527,527,544,525,527,527,534,525,562,562,600,596,563,563,601,526,442,442,439,447,442,442,441,447,442,442,455,475,459,459,476,465,442,442,439,447,442,442,441,447,445,445,471,490,459,459,495,470,557,557,546,593,557,557,562,594,578,578,546,633,757,757,627,787,527,527,544,525,527,527,534,525,562,562,600,596,568,568,601,592,566,566,548,584,566,566,558,583,551,551,524,554,605,605,554,623,566,566,548,584,566,566,558,583,559,559,549,584,605,605,594,630,573,573,548,606,573,573,562,604,578,578,546,633,757,757,627,787,770,770,769,772,770,770,773,773,779,779,600,625,819,819,606,791,510,510,522,496,510,510,518,498,525,525,531,530,505,505,531,465,510,510,522,496,510,510,518,498,523,523,530,524,505,505,522,485,557,557,546,593,557,557,562,594,578,578,546,633,757,757,627,787,569,569,592,537,569,569,582,539,591,591,600,596,563,563,601,526,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,400,402,396,402,397,406,395,406,415,402,396,402,398,426,449,426,388,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,413,479,483,479,456,490,490,490,502,479,483,479,458,513,559,513,458,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,470,402,396,402,397,406,395,406,415,402,396,402,398,426,449,426,388,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,448,479,483,479,456,490,490,490,502,479,483,479,458,513,559,513,506,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,400,402,396,402,397,406,395,406,415,402,396,402,398,426,449,426,388,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,413,479,483,479,456,490,490,490,502,479,483,479,458,513,559,513,458,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,400,402,396,402,397,406,395,406,415,402,396,402,398,426,449,426,388,381,384,381,384,387,388,387,391,381,384,381,384,401,411,401,413,479,483,479,456,490,490,490,502,479,483,479,458,513,559,513,458,355,355,355,356,355,355,355,359,355,355,355,356,401,401,401,375,355,355,356,366,355,355,355,364,355,355,356,366,401,401,401,406,355,355,355,356,355,355,355,359,355,355,355,356,425,425,419,375,395,395,394,400,395,395,396,413,395,395,394,400,533,533,533,466,355,355,355,356,355,355,355,359,355,355,355,356,401,401,401,375,355,355,356,366,355,355,355,364,355,355,356,366,401,401,401,406,355,355,355,356,355,355,355,359,355,355,355,356,425,425,419,375,395,395,394,400,395,395,396,413,395,395,394,400,533,533,533,466,355,355,355,356,355,355,355,359,355,355,355,356,401,401,401,375,355,355,356,366,355,355,355,364,355,355,356,366,401,401,401,406,355,355,355,356,355,355,355,359,355,355,355,356,425,425,419,375,407,407,398,400,413,413,412,427,407,407,398,400,533,533,533,466,355,355,355,356,355,355,355,359,355,355,355,356,401,401,401,375,355,355,356,366,355,355,355,364,355,355,356,366,401,401,401,406,355,355,355,356,355,355,355,359,355,355,355,356,425,425,419,375,430,430,422,400,437,437,435,450,430,430,422,400,533,533,533,466,434,434,434,437,434,434,441,437,445,445,442,472,475,475,455,459,434,434,445,437,434,434,446,437,464,464,472,518,513,513,501,490,518,518,481,567,518,518,514,567,509,509,469,556,593,593,514,605,576,576,588,558,576,576,597,558,611,611,607,661,633,633,663,585,434,434,436,437,434,434,441,437,445,445,442,472,475,475,455,459,434,434,445,437,434,434,446,437,464,464,472,518,513,513,501,490,518,518,481,567,518,518,514,567,509,509,469,556,593,593,514,605,576,576,588,558,576,576,597,558,611,611,607,661,633,633,663,585,498,498,450,523,498,498,481,523,459,459,442,472,489,489,455,530,498,498,469,523,498,498,490,523,488,488,472,518,536,536,504,582,518,518,481,567,518,518,514,567,509,509,469,556,593,593,514,605,576,576,588,601,576,576,597,601,611,611,607,661,633,633,663,585,521,521,473,531,521,521,504,531,482,482,442,472,512,512,455,535,521,521,492,531,521,521,513,531,511,511,489,535,541,541,527,537,518,518,481,567,518,518,514,567,509,509,469,556,593,593,514,605,576,576,588,567,576,576,597,567,611,611,607,661,633,633,663,585];

%array[NON_SHIFTS union SHIFTS] of int: nShiftWorkDuration = array1d(NON_SHIFTS union SHIFTS, [0, 9, 9, 11]);
array[NON_SHIFTS union SHIFTS] of int: nShiftWorkDuration = array1d(NON_SHIFTS union SHIFTS, [0, 85, 85, 85]);

/* CRC Alertness-Aware Scheduling
 *
 * TODO  
 */

set of int: DAYS = index_set( nWeekdayOf );
set of int: NURSES = index_set( nNurseType );  %% ANUM==1, CNS==2
set of int: SHIFTS = 1..3;        %% day, evening, night.  0 == no duty
set of int: NON_SHIFTS = 0..0;     %% If the days' value is in, it's a free day
set of int: BIOTYPES = 1..nBioTypes;
set of int: ALLPATTERNS = 1..pow(length(NON_SHIFTS union SHIFTS),nEvalHorizon);

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%% TRANSFORMING 1D DATA ARRAYS %%%%%%%%%%%%%%%%%%%%%%
%% EXAMPLE DATA. Shift numbers
% array [int, int] of SHIFTS union NON_SHIFTS: nShift__DATA = array2d( NURSES, DAYS, nShift__DATA_1D );
% array [int, int] of int: nFatigueParams = array2d( BIOTYPES, ALLPATTERNS, nFatigueParams__DATA_1D );

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%% TRANSFORMING 1D / CREATING VAR ARRAYS %%%%%%%%%%%%%%%%%%%%%
%% PRIMARY VARIABLES. Shift numbers
array [NURSES, DAYS] of var SHIFTS union NON_SHIFTS: nShift;% = array2d( NURSES, DAYS, nShift_1D );

%% SECONDARY VARIABLES. Positive diff to example data.
% array [ NURSES, DAYS ] of var 0..1: bDiff2Data =
%     array2d( NURSES, DAYS, [
% %      if is_fixed( nShift[ n, d ] ) then
%         nShift__DATA[ n, d ]!=nShift[ n, d ]
% %      elseif nShift__DATA[ n, d ] in dom( nShift[ n, d ] ) then
% %        _
% %      else
% %        1
% %      endif
%     | n in NURSES, d in DAYS ] );

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% PREDICATES %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% test is_night__DATA( int: n, int: d ) = (3==nShift__DATA[ n, d ]);
% test is_working__DATA( int: n, int: d )  = (0< nShift__DATA[ n, d ]);
predicate is_night( int: n, int: d ) = (sh[n,d,3]);%(3==nShift[ n, d ]);
predicate is_day( int: n, int: d )   = (sh[n,d,1]);%(1==nShift[ n, d ]);
predicate is_eve( int: n, int: d )   = (sh[n,d,2]);%(2==nShift[ n, d ]);
predicate is_idle( int: n, int: d )  = 0==sum(s in SHIFTS)(sh[n,d,s]);%not (sh[n,d,1] \/ sh[n,d,2] \/ sh[n,d,3]);%0==sum(s in SHIFTS)(sh[n,d,s]);%(0==nShift[ n, d ]);
predicate is_working( int: n, int: d )  = not is_idle( n, d );
predicate is_working_some_of( int: n, int: d1, int: d2 ) =
    exists( d in d1..d2 )( is_working( n, d ) );


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% CONSTRAINTS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  +++++++++++++++++++++++++++++++++++++++++++++++++++++++++

constraint assert( 1==nWeekdayOf[1], "The 1st day should be a Monday" );
constraint assert( length(nNurseType)<=length(nNurseBioType), "Length of  array nNurseType is larger than the nNurseBioType" );

array[NURSES,DAYS,SHIFTS] of var bool: sh;
constraint forall( n in NURSES, d in DAYS, s in SHIFTS )(sh[n,d,s]=(s==nShift[ n, d ])); %A shift or an off-day is allocated each day
constraint forall (n in NURSES, d in DAYS)(sum(s in SHIFTS)(sh[n,d,s])<=1);  %Max 1 shift per day
%%%%%%%%%%%% SHIFT COVERAGE %%%%%%%%%%%%%%  +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
constraint forall( d in DAYS, s in SHIFTS )(
  sum( n in NURSES )( sh[ n, d, s ] )
                                             >= nCovAll[s] );  %Demand for personnel must be covered for each shift every day.
% %%%%%%%%%%%% SHIFT COVERAGE ANUMS %%%%%%%%%%%%%%
% constraint forall( d in DAYS, s in SHIFTS )(
%   sum( n in NURSES where 1==nNurseType[n] )( sh[ n, d, s ] )
%                                              >= nCovANUM[s]);  %If skill-mix, add nursetype-demands here
%%%%%%%%%%%% SHIFT COVERAGE CNS %%%%%%%%%%%%%%
% constraint forall( d in DAYS, s in SHIFTS )(
%   sum( n in NURSES where 1==nNurseType[n] \/ 3==nNurseType[n] )( sh[ n, d, s ] )
%                                              >= nCovCNS);

%% Maximum total work
%% Number of successive night shifts is no more than 3
int: maxTotalWorkPerWeek = 38*10;
constraint forall( n in NURSES )(      
                   sum( d in DAYS )( nShiftWorkDuration[nShift[n,d]] ) <= maxTotalWorkPerWeek * (max(DAYS) div 7 ) );%Max wewekly work is 38 hrs on avg.
                   
%% Minimum total work      Temporarily removed
 0..1: applyMinWorkTime;
int: minTotalWorkPerWeek = if applyMinWorkTime==1 then 35*10 else 0 endif;
constraint forall( n in NURSES )(      
                   sum( d in DAYS )( nShiftWorkDuration[nShift[n,d]] ) >= minTotalWorkPerWeek * (max(DAYS) div 7 ) ); %Apply min work time for realism
                                             
 %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%  +++++++++++++++++++++++++++++++++++++++++++++++++++++++++
%%%%%%%%%%%%%%%%%%%%%%%%%%MODEL EXTENSIONS%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%0..1: extFatigue;
0..1: extShiftWork;
%%%%%%%%%%%% Regulatory Constraints %%%%%%%%%%%%%%  ++++++++++++++++++++++++++++++++++++++++++++++++++++

%% Number of successive night shifts is no more than 3
constraint if extShiftWork==1 then forall( n in NURSES, d in DAYS where d <= max(DAYS)-3 )(      
                   sum( d1 in d..d+3 )( is_night( n, d1 ) ) <= 3 )
           else true endif;
                   
%% No more than 50 hours of work in a week, starting from 1 to 7
constraint if extShiftWork==1 then forall( n in NURSES, d in 0..(max(DAYS)-1) div 7 )(
let {int: kd = (7*d)+1} in       
                   sum( d1 in kd..kd+6 )( nShiftWorkDuration[nShift[n,d1]] ) <= 50*10)
           else true endif;
                

%% Weekend OFF: Within a 3-week period atleast one weekend is off 
%% and corresponding week's Friday's shift cannot be a night shift but the Sunday can be a night shift
constraint if extShiftWork==1 then forall( n in NURSES, kd in 0..(max(DAYS) div 7 - 3) )(       %% no 3 weekends working (already 1 day/we enough)  TODO
    let {
      int: dSat1 = 7*kd+6,
    } in
    ( is_working_some_of( n, dSat1, dSat1+1 ) /\ is_working_some_of( n, dSat1+7, dSat1+8 ) /\
        is_working_some_of( n, dSat1+14, dSat1+15 ) )
)
           else true endif;

%% Forward rotations of shifts
constraint if extShiftWork==1 then forall( n in NURSES, d in DAYS where d <= max(DAYS)-1 )(
                   not ( is_night( n, d ) /\ is_day(n,d+1) )  )
           else true endif;
constraint if extShiftWork==1 then forall( n in NURSES, d in DAYS where d <= max(DAYS)-1 )(
                   not ( is_night( n, d ) /\ is_eve(n,d+1) )  )
           else true endif;
constraint if extShiftWork==1 then forall( n in NURSES, d in DAYS where d <= max(DAYS)-1 )(
                   not ( is_eve( n, d ) /\ is_day(n,d+1) )  )
           else true endif;

%% After every N (say 10) number of days there should be a two consecutive OFF days, similar to weekend OFF constraint
int: nConsecWorkOFF = 10;
constraint if extShiftWork==1 then forall( n in NURSES, d in DAYS where d <= max(DAYS)-nConsecWorkOFF -2)(
                   if sum( d1 in d..d+nConsecWorkOFF-1 )( is_idle( n, d1 ) /\ is_idle( n, d1+1 ) ) ==  0 then ( is_idle( n, d+nConsecWorkOFF+1 ) /\ is_idle(n,d+nConsecWorkOFF+2) ) else true endif )
           else true endif;

%% Ruleout N-O-N transitions
constraint if extShiftWork==1 then forall( n in NURSES, d in DAYS where d <= max(DAYS)-2 )(
                   not ( is_night( n, d ) /\ is_idle(n,d+1) /\ is_night(n,d+2))  )
           else true endif;

%% Limit the consecutive work days to 6.
int: nConsecWork = 6;
constraint if extShiftWork==1 then forall( n in NURSES, d in DAYS where d <= max(DAYS)-nConsecWork )(
                   not forall( d1 in d..d+nConsecWork )( is_working( n, d1 ) ) )
           else true endif;
